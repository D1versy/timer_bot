#!/usr/bin/env python3
"""–ú–∞—Å—Å–æ–≤–æ–µ –≤–Ω–µ—Å–µ–Ω–∏–µ —É–±–∏–π—Å—Ç–≤ –±–æ—Å—Å–æ–≤ –≤ –ë–î."""
from datetime import datetime
from zoneinfo import ZoneInfo
from app.db import SessionLocal
from app.models import Boss, KillLog

MOSCOW = ZoneInfo("Europe/Moscow")

# –°–ª–æ–≤–∞—Ä—å: –∏–º—è –±–æ—Å—Å–∞ -> ID (–∏–∑ –ø–æ—Ä—è–¥–∫–∞ –≤ seed_data.py)
BOSS_IDS = {
    "–ê–Ω–¥—Ä–∞—Å": 1, "–ë–∞–∑–∏–ª": 2, "–ë–∞–ª–ª–∞–∫": 3, "–ë–∞–ª—å–±–æ": 4, "–ë–∞—Ä–æ–Ω": 5,
    "–ë—Ä–µ–∫–∞": 6, "–ë—É—Ä—è": 7, "–ì–∞—Ä–µ—Ç": 8, "–ì–µ–∫–∞—Ç–æ–Ω": 9, "–ì–ª–∞–∫–∏": 10,
    "–ó–∞—Ä–∞–∂–µ–Ω–Ω—ã–π –ö—Ä—É–º–∞": 11, "–ó–µ—Ä–∫–∞–ª–æ –ó–∞–±–≤–µ–Ω–∏—è": 12, "–ö–∞–±—Ä–∏–æ": 13, "–ö–∞–º–µ–Ω—É–∫": 14, "–ö–∞—Ç–∞–Ω": 15,
    "–ö–µ–ª—å—Å—É—Å": 16, "–ö–æ—Ä–æ–ª–µ–≤–∞ –ú—É—Ä–∞–≤—å–µ–≤": 17, "–ö–æ—Ä—É–Ω": 18, "–õ–∞–Ω–¥–æ—Ä": 19, "–ú–∞—Ç—É—Ä–∞": 20,
    "–ú–µ–¥—É–∑–∞": 21, "–ú–æ–¥–µ—É—Å": 22, "–ú—É—Ç–∞–Ω—Ç –ö—Ä—É–º–∞": 23, "–ù–∞—è–¥–∞": 24, "–û–ª–∫—É—Ç": 25,
    "–û—Ä—Ñ–µ–Ω": 26, "–ü–∞–Ω –î—Ä–∞–π–¥": 27, "–ü–∞–Ω –ú–∞—Ä–æ–¥": 28, "–†–∞—Ö—Ö–∞": 29, "–†–µ–ø–∏—Ä–æ": 30,
    "–°–∞–±–∞–Ω": 31, "–°–∞–π—Ä–∞–∫—Å": 32, "–°–∞–º—É—ç–ª—å": 33, "–°–µ–ª—É": 34, "–°—É—Å—Ü–µ–ø—Ç–æ—Ä –Ø–¥—Ä–∞": 35,
    "–¢–∞–ª–∞–∫–∏–Ω": 36, "–¢–∞–ª–∫–∏–Ω": 37, "–¢–∞–Ω–∞—Ç–æ—Å": 38, "–¢–∏–º–∏–Ω–∏—ç–ª—å": 39, "–¢–∏–º–∏—Ç—Ä–∏—Å": 40,
    "–§–∞—Ä–æ–±–æ—Å": 41, "–§–µ–ª–∏—Å": 42, "–§–µ–Ω–∏–∫—Å": 43, "–§–æ–ª–ª–∏–Ω—Ç": 44, "–•–∞—Ñ—Ñ": 45,
    "–•–∏—Å–∏–ª—Ä–æ–º": 46, "–ß–µ—Ä–Ω–∞—è –õ–∏–ª–∏—è": 47, "–ß–µ—Ä—Ç—É–±–∞": 48, "–ß—É–¥–æ–≤–∏—â–µ": 49, "–ß—É–¥–æ–≤–∏—â–Ω—ã–π –î—Ä–∞–∫–æ–Ω": 50,
    "–®–∞—Ä–∫–∞": 51, "–≠–Ω–∫—É—Ä–∞": 52,
}

# –î–∞–Ω–Ω—ã–µ —É–±–∏–π—Å—Ç–≤: (–∏–º—è, –¥–∞—Ç–∞, –≤—Ä–µ–º—è)
KILLS = [
    # 01.02.2026
    ("–ö–µ–ª—å—Å—É—Å", "01.02.2026", "16:57"),
    ("–ß—É–¥–æ–≤–∏—â–µ", "01.02.2026", "17:03"),
    ("–ì–∞—Ä–µ—Ç", "01.02.2026", "17:03"),
    ("–õ–∞–Ω–¥–æ—Ä", "01.02.2026", "17:04"),
    ("–§–æ–ª–ª–∏–Ω—Ç", "01.02.2026", "17:04"),
    ("–°–∞–±–∞–Ω", "01.02.2026", "17:04"),
    ("–•–∏—Å–∏–ª—Ä–æ–º", "01.02.2026", "17:05"),
    ("–ß–µ—Ä—Ç—É–±–∞", "01.02.2026", "17:08"),
    ("–ú–µ–¥—É–∑–∞", "01.02.2026", "17:15"),
    ("–ü–∞–Ω –î—Ä–∞–π–¥", "01.02.2026", "18:06"),
    ("–®–∞—Ä–∫–∞", "01.02.2026", "18:09"),
    ("–†–µ–ø–∏—Ä–æ", "01.02.2026", "18:10"),
    ("–§–∞—Ä–æ–±–æ—Å", "01.02.2026", "18:41"),
    ("–ö–æ—Ä—É–Ω", "01.02.2026", "19:00"),
    ("–ö–æ—Ä–æ–ª–µ–≤–∞ –ú—É—Ä–∞–≤—å–µ–≤", "01.02.2026", "19:13"),
    ("–ë—É—Ä—è", "01.02.2026", "19:36"),
    ("–ë–∞–ª—å–±–æ", "01.02.2026", "20:56"),
    ("–ß–µ—Ä–Ω–∞—è –õ–∏–ª–∏—è", "01.02.2026", "21:02"),
    ("–ó–µ—Ä–∫–∞–ª–æ –ó–∞–±–≤–µ–Ω–∏—è", "01.02.2026", "21:04"),
    ("–ö–∞–±—Ä–∏–æ", "01.02.2026", "21:07"),
    ("–°–∞–º—É—ç–ª—å", "01.02.2026", "21:09"),
    ("–¢–∏–º–∏—Ç—Ä–∏—Å", "01.02.2026", "21:15"),
    ("–ì–ª–∞–∫–∏", "01.02.2026", "21:16"),
    ("–ó–∞—Ä–∞–∂–µ–Ω–Ω—ã–π –ö—Ä—É–º–∞", "01.02.2026", "21:18"),
    ("–¢–∏–º–∏–Ω–∏—ç–ª—å", "01.02.2026", "21:18"),
    ("–ú—É—Ç–∞–Ω—Ç –ö—Ä—É–º–∞", "01.02.2026", "21:26"),
    ("–ö–∞—Ç–∞–Ω", "01.02.2026", "21:29"),
    # 02.02.2026
    ("–°—É—Å—Ü–µ–ø—Ç–æ—Ä –Ø–¥—Ä–∞", "02.02.2026", "01:03"),
    ("–ß—É–¥–æ–≤–∏—â–Ω—ã–π –î—Ä–∞–∫–æ–Ω", "02.02.2026", "01:06"),
    ("–•–∞—Ñ—Ñ", "02.02.2026", "08:57"),
    ("–¢–∞–Ω–∞—Ç–æ—Å", "02.02.2026", "12:53"),
    ("–û–ª–∫—É—Ç", "02.02.2026", "12:58"),
    ("–û—Ä—Ñ–µ–Ω", "02.02.2026", "12:56"),
    ("–§–µ–Ω–∏–∫—Å", "02.02.2026", "13:02"),
    ("–ú–æ–¥–µ—É—Å", "02.02.2026", "13:59"),
]


def parse_datetime(date_str: str, time_str: str) -> datetime:
    """DD.MM.YYYY HH:MM -> datetime Moscow."""
    d, m, y = map(int, date_str.split("."))
    h, mi = map(int, time_str.split(":"))
    return datetime(y, m, d, h, mi, tzinfo=MOSCOW)


def main():
    db = SessionLocal()
    try:
        added = 0
        for name, date_str, time_str in KILLS:
            boss_id = BOSS_IDS.get(name)
            if not boss_id:
                print(f"‚ö†Ô∏è  –ë–æ—Å—Å '{name}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–æ–≤–∞—Ä–µ")
                continue
            
            boss = db.query(Boss).filter(Boss.id == boss_id).first()
            if not boss:
                print(f"‚ö†Ô∏è  –ë–æ—Å—Å ID {boss_id} ({name}) –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î")
                continue
            
            killed_at = parse_datetime(date_str, time_str)
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º naive –¥–ª—è –ë–î
            killed_at_naive = killed_at.astimezone(MOSCOW).replace(tzinfo=None)
            
            boss.last_kill_at = killed_at_naive
            db.add(KillLog(boss_id=boss.id, killed_at=killed_at_naive, note="bulk import"))
            added += 1
            print(f"‚úÖ [{boss.id}] {boss.name} ‚Äî {date_str} {time_str}")
        
        db.commit()
        print(f"\nüéâ –í–Ω–µ—Å–µ–Ω–æ {added} —É–±–∏–π—Å—Ç–≤.")
    finally:
        db.close()


if __name__ == "__main__":
    main()
